// Generated by CoffeeScript 1.9.3
(function() {
  var DEMO, HOST, ref, ref1;

  require("./angular");

  require("./angular-sanitize");

  HOST = ((ref = window.DDCONF) != null ? ref.HOST : void 0) || "";

  DEMO = ((ref1 = window.DDCONF) != null ? ref1.DEMO : void 0) != null;

  angular.module("doubledonation_register", []).controller("RegisterController", function($scope, $http) {
    var initial_plan, prefilled_plan, ref2, ref3;
    if (DDCONF.PARTNER === "donorpro") {
      $scope.donorpro = {
        donorpro_annually: "Billed $399 annually",
        donorpro_twoyears: "Billed $678 every 2 years"
      };
      initial_plan = "donorpro_annually";
    } else if (DDCONF.PARTNER === "clickandpledge") {
      $scope.clickandpledge = {
        plan: "clickandpledge_annually"
      };
      initial_plan = "clickandpledge_annually";
    } else {
      if (prefilled_plan = (ref2 = window.location.search) != null ? (ref3 = ref2.match(/\?plan=(\w+)/)) != null ? ref3[1] : void 0 : void 0) {
        $scope.prefilled = true;
      }
      initial_plan = prefilled_plan || "small_199_annually";
    }
    $scope.register_form = {
      plan: initial_plan,
      cc_info: {}
    };
    $scope.plans = {
      small_199_annually: "Hosted Plan at $199/year",
      pro_399_annually: "Embedded Plan at $399/year",
      silver_699_annually: "Tier 3 at $699/year",
      small_338_twoyears: "Tier 1 at $169/year for 2 years (billed upfront)",
      pro_678_twoyears: "Tier 2 at $339/year for 2 years (billed upfront)",
      silver_1198_twoyears: "Tier 3 at $599/year for 2 years (billed upfront)"
    };
    return $scope.submitForm = function(form, valid) {
      var req;
      $scope.register_form.submitted = true;
      $scope.errors = null;
      if (valid) {
        $scope.button_disabled = true;
        req = $http.post("/api/register", $scope.register_form);
        req.success(function() {
          location.href = "https://doublethedonation.com/members/home";
          return false;
        });
        return req.error(function(data) {
          $scope.button_disabled = false;
          return $scope.errors = data;
        });
      }
    };
  });

  angular.element(document).ready(function() {
    var register_form;
    register_form = document.querySelector(".doubledonation-register");
    if (register_form) {
      return angular.bootstrap(register_form, ['doubledonation_register']);
    }
  });

}).call(this);
